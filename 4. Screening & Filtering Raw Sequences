# The "screen.seqs" command within mothur trimmeed our raw microbiome sequences to have
# no ambiguous base pairs, a minimum length of 1350 base pairs long, and a maximum lenght of 
# 1600 base pairs long.

# # This pipeline was run using the screen.seqs command within the mothur module

#######################################

#!/bin/bash
#SBATCH --time=24:00:00   # walltime
#SBATCH --ntasks=4        # number of processor cores (i.e. tasks)
#SBATCH --nodes=1         # number of nodes
#SBATCH --mem=4G          # total memory
#SBATCH -J "mothur_FQC_screen_loop" # job name
#SBATCH --output="mothur_FQC_screen_loop"  # include job ID in output

# Load modules
module load GCC/12.3.0
module load mothur/1.48.2

# Define input/output
input_dir="/scratch/user/carlylo/Cass_Microbiome/Mothur_Fastq_Output"
output_dir="/scratch/user/carlylo/Cass_Microbiome/Mothur_Screen_Output/FQC"

# Find all .fasta files in the input directory and loop through them
find "$input_dir" -type f -name "*.fasta" | while IFS= read -r fasta_file; do

    # Get sample name without extension
    sample_name=$(basename "$fasta_file" .fasta)

    # Debug message
    echo "Processing sample: $sample_name"

    # Run mothur with output directory and screen.seqs
    mothur "#set.dir(output=$output_dir); screen.seqs(fasta=$fasta_file, maxambig=0, minlength=1350, maxlength=1600)"

    echo "Finished processing: $sample_name"
done

echo "All samples processed!" 
